/*! TT-UI.Table 0.1.1 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ttui-table"),function(a,b,c){"use strict";function d(a,c,d,e){return{restrict:"A",scope:!1,require:["ttTable","^stTable"],controllerAs:"tableCtrl",bindToController:{tableModel:"=stTable",stPipe:"=",stItemsByPage:"="},controller:["$scope","$element",function(a,d){var f=this;f.service=e.create(f),f.selectAll=!1,f.colspan=0,f.enablePagination=!0,f.filters=[],f.dropdowns=[];var g=function(){var a={selected:!1,expanded:!1};b.forEach(f.tableModel,function(c){b.isDefined(c._meta)||(c._meta=b.copy(a))})},h=function(){if(f.tableModel){var a=f.tableModel.length,c=0;return b.forEach(f.tableModel,function(a){a._meta&&a._meta.selected&&c++}),c===a&&c>0}},i=function(){var a=b.element(d.find("thead"));b.forEach(a,function(a){var c=b.element(a);if(c.hasClass("main-header")){var d=c.find("th");f.colspan=d.length}})},j=function(){d.addClass("show"),i()};f.toggleSelectAll=function(){b.forEach(f.tableModel,function(a){f.selectAll?a._meta&&(a._meta.selected=!0,f.service.addSelected(a)):a._meta&&(a._meta.selected=!1,f.service.removeSelected(a))})},f.toggleExpanded=function(a){a._meta.expanded=!a._meta.expanded,a._meta.expanded?f.service.addExpanded(a):f.service.removeExpanded(a)},f.sum=function(a){var c=0;return b.forEach(f.tableModel,function(b){c+=b[a]}),c},f.getColumnData=function(a){var c=null;if(b.forEach(f.dropdowns,function(b){b.filters&&a===b.predicate&&(c=b)}),c)return b.copy(c.filters);var d=[];return b.forEach(f.tableModel,function(b){d.push({title:b[a],path:a})}),d},f.onDataLoaded=function(){g(),k()},f.removeTag=function(a,c,d){var e=!1;return d.preventDefault(),b.forEach(f.dropdowns,function(b){a===b.predicate&&(b.unSelectItemByValue(c),e=!0)}),e||f.tableState.search.predicateObject&&delete f.tableState.search.predicateObject[a],e},f.showActions=function(){return f.service.getSelectedCount()>0},f.getSelectionModel=function(){return f.service.getSelected()},f.get=function(){return f};var k=function(){b.forEach(f.tableModel,function(a){f.service.isSelected(a)&&(a._meta.selected=!0),f.service.isExpanded(a)&&(a._meta.expanded=!0)})};a.$watch("tableCtrl.tableModel",function(){h()?f.selectAll=!0:f.selectAll=!1},!0),c(j,0)}],link:function(a,b,c,d){var e=d[0],f=d[1];e.tableState=f.tableState(),e.stTableCtrl=f}}}function e(a){return{restrict:"A",scope:!1,require:["^stDirection"],bindToController:!0,controllerAs:"stDirectionCtrl",controller:function(){},link:function(b,c,d,e){e[0].direction=a[0].dir||"ltr"}}}function f(a){return{restrict:"E",scope:!1,require:["^ttTable"],bindToController:!0,controllerAs:"paginationCtrl",template:'<div st-pagination="" st-items-by-page="paginationCtrl.itemsByPage" st-displayed-pages="5" st-template="scripts/ttui-table/table-pagination.tpl.html" class="pull-right"></div>',controller:function(){this.itemsByPage=10},link:function(b,c,d,e){var f=e[0];a(function(){b.paginationCtrl.itemsByPage=f.stItemsByPage},0)}}}function g(){return{restrict:"E",scope:{value:"=",selectionModel:"="},bindToController:!0,require:["ttTableCheckbox","^ttTable"],controllerAs:"checkCtrl",template:'<a class="table-checkbox glyphicon" ng-class="checkCtrl.getCss()" ng-click="checkCtrl.click($event)"></a>',controller:["$scope","$element","$attrs",function(a,c,d){var e=this;e.checkOff="ttui-table-checkbox-unchecked",e.checkOffActive="ttui-table-checkbox-unchecked-active",e.checkOn="ttui-table-checkbox-checked",e.value=!1,e.active=!1;var f=!!b.isDefined(d.$attr.noClick);e.toggle=function(){e.value=!e.value,e.selectionModel&&(e.value?e.tableCtrl.service.addSelected(e.selectionModel):e.tableCtrl.service.removeSelected(e.selectionModel))},e.setValue=function(a){e.value=a},e.getValue=function(){return e.value},e.click=function(a){e.toggle(),f&&a.stopPropagation()},b.element(c).bind("mouseover",function(){e.active=!0,a.$digest()}),b.element(c).bind("mouseout",function(){e.active=!1,a.$digest()}),e.getCss=function(){return e.value?e.checkOn:e.active?e.checkOffActive:e.checkOff}}],link:function(a,b,c,d){d[0].tableCtrl=d[1]}}}function h(a){return{restrict:"AE",scope:!0,bindToController:!0,controllerAs:"tooltipCtrl",compile:function(){var c=!1;return{pre:function(){},post:function(d,e,f){var g=d.$eval(f.ttTableTooltip)||20,h=d.$eval(f.ngBind),i=b.isDefined(h)?h:e.text()+"",j={"uib-tooltip":i,"tooltip-class":"table-tooltip","tooltip-trigger":"mouseenter"};i.length>g&&(e.addClass("ellipsis"),e.attr(j),e.removeAttr("tt-table-tooltip"),c=!0),c&&a(e)(d)}}}}}function i(){return{restrict:"AE",scope:{tipText:"=text"},bindToController:!0,require:["ttTableTextTooltip"],template:'<span uib-tooltip="{{textTooltipCtrl.getTipText()}}" tooltip-class="table-tooltip" tooltip-trigger="mouseenter">{{textTooltipCtrl.getTipTextShort()}}</span>',controllerAs:"textTooltipCtrl",controller:function(){},link:function(a,b,c,d){var e=d[0],f=20;e.tipTextLen=e.tipText.length,e.getTipText=function(){return e.tipTextLen>f?e.tipText:""},e.getTipTextShort=function(){return e.tipTextLen>f?e.tipText.substr(0,17)+"...":e.tipText}}}}function j(a,d,e,f){return{restrict:"AE",scope:!0,bindToController:!0,require:["ttTableDropdown","^ttTable","^stTable"],controllerAs:"dropdownCtrl",controller:function(){},compile:function(a){var g=b.element('<span class="glyphicon glyphicon-filter filter-indicator"></span>'),h=b.element('<ul class="uib-dropdown-menu" uib-dropdown-menu template-url="scripts/ttui-table/table-filter-dropdown.tpl.html"></ul>');return a.append(g),a.append(h),a.addClass("add-pointer"),function(a,g,h,i){var j=i[0],k=i[1],l=i[2],m=i[2].tableState();j.reverse=c,j.input="",j.isOpen=!1,j.items=[],j.disableAutoFilters=a.$eval(h.disableAutoFilters),j.predicate=a.$eval(h.path),j.filters=a.$eval(h.setFilters),k.tableState=m,k.dropdowns.push(j);var n=function(){var a=f("filter")(j.items,{selected:!0}),b=[].concat(a).map(function(a){return a.title});return j.input&&b.push(j.input),b.join()};if(b.isDefined(h.buildFilterStringFn)){var o=e(h.buildFilterStringFn);j.buildFilterStringFn=function(){return o(a)}}else j.buildFilterStringFn=n;j.isDropdownOpen=function(){return j.isOpen},j.sort=function(){j.reverse=!j.reverse||!1,l.sortBy(j.predicate,j.reverse)},j.search=function(){var a=j.buildFilterStringFn();""!==a&&l.search(a,j.predicate)},j.toggleSelectItem=function(a){a.selected=!a.selected;var b=j.buildFilterStringFn();l.search(b,j.predicate)},j.unSelectItemByValue=function(a){b.forEach(j.items,function(b){a===b.title&&(b.selected=!1)}),a===j.input&&(j.input="");var c=j.buildFilterStringFn();l.search(c,j.predicate)},j.selectAll=function(){for(var a=0;a<j.items.length;a++)j.items[a].selected=!0;var b=j.buildFilterStringFn();l.search(b,j.predicate)},j.unSelectAll=function(){for(var a=0;a<j.items.length;a++)j.items[a].selected=!1},j.getSelectedFilters=function(){for(var a=[],b=0;b<j.items.length;b++)j.items[b].selected&&a.push(j.items[b]);return a},j.close=function(){j.isOpen=!1},j.clear=function(){(j.hasSelections()||p())&&(m.search.predicateObject&&delete m.search.predicateObject[j.predicate],m.sort&&(m.sort.predicate="",m.sort.reverse=!1),j.reverse=c,j.input="",j.unSelectAll(),l.pipe())},j.hasSelections=function(){return j.getSelectedFilters().length>0||!0===j.reverse||!1===j.reverse||""!==j.input};var p=function(){return b.isDefined(j.disableAutoFilters)&&!0===j.disableAutoFilters},q=function(){return b.isDefined(j.filters)},r=function(){var a=j.getSelectedFilters(),c=k.getColumnData(j.predicate);j.items=f("unique")(b.merge(c,a),"title")};a.$watch("dropdownCtrl.isOpen",function(b){!b||p()&&!q()||r(),g.toggleClass("is-open",j.isOpen),d(function(){a.$broadcast("ttTableFocus",j.predicate)})}),a.$watch("tableCtrl.tableModel",function(){p()||q()||r()}),a.$watch("dropdownCtrl.items",function(){g.toggleClass("has-selected",j.hasSelections())}),a.$watch("tableCtrl.tableState",function(){g.toggleClass("has-selected",j.hasSelections())},!0)}}}}function k(a){return{restrict:"A",scope:!0,link:function(c,d,e){var f=e.ttTableFilterDropdownToggle,g=function(){var d=b.element(a[0].querySelector("#"+f)),e=d.scope();e&&(e.dropdownCtrl.isOpen=!e.dropdownCtrl.isOpen,c.$apply())};b.element(d).bind("click",g)}}}function l(){return{restrict:"E",scope:{tags:"=",excludeKeys:"=",tagDelimiter:"@"},bindToController:!0,require:["ttTableFilterTags","^ttTable"],controllerAs:"tagsCtrl",template:'<a class="label label-default" href ng-repeat="tag in tagsCtrl.displayTags">{{tag.text}} <span class="glyphicon glyphicon-remove" ng-click="tagsCtrl.removeTag($event, tag)"></span></a>',controller:function(){},link:function(a,c,d,e){function f(b){return a.tagsCtrl.excludeKeys&&-1!==a.tagsCtrl.excludeKeys.indexOf(b)}var g=e[0];g.tableCtrl=e[1],g.displayTags=[];var h=g.tagDelimiter||",",i=function(a){var b=g.displayTags.indexOf(a);-1!==b&&g.displayTags.splice(b,1)};g.removeTag=function(a,b){var c=b.text.split(" : "),d=c[0],e=c[1];g.tableCtrl.removeTag(d,e,a)||i(b)};var j=function(){g.displayTags=[],b.forEach(g.tags,function(a,b){if(!f(b))for(var c=a.split(h),d=0;d<c.length;d++){var e={};e.text=b+" : "+c[d],""!==c[d]&&g.displayTags.push(e)}})};a.$watch("tagsCtrl.tags",function(){j()},!0)}}}function m(){return function(a,b,c){a.$on("ttTableFocus",function(a,d){d===c.ttTableFocus&&b[0].focus()})}}function n(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ttTableEnter)}),b.preventDefault())})}}var o=b.module("TT-UI.Table",["ngAnimate","ui.bootstrap.position","ui.bootstrap.tooltip","ui.bootstrap.popover","ui.bootstrap.collapse","ui.bootstrap.tabs","ui.bootstrap.dropdown","uib/template/tooltip/tooltip-popup.html","uib/template/tabs/tab.html","uib/template/tabs/tabset.html","pascalprecht.translate","smart-table","TT-UI.Table.Filters","TT-UI.Table.Service","TT-UI.Table.Directives"]);o.config(["$uibTooltipProvider",function(a){a.options({appendToBody:!0})}]),b.module("TT-UI.Table.Minimal",["ngAnimate","ui.bootstrap.collapse","smart-table","TT-UI.Table.Filters","TT-UI.Table.Service","TT-UI.Table.Directives"]);var o=b.module("TT-UI.Table.Service",[]),p=function a(){var c={},d={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,e,f,g,h,i,j="",k=0;for(a=d._utf8_encode(a);k<a.length;)b=a.charCodeAt(k++),c=a.charCodeAt(k++),e=a.charCodeAt(k++),f=b>>2,g=(3&b)<<4|c>>4,h=(15&c)<<2|e>>6,i=63&e,isNaN(c)?h=i=64:isNaN(e)&&(i=64),j=j+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h)+this._keyStr.charAt(i);return j},decode:function(a){var b,c,e,f,g,h,i,j="",k=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<a.length;)f=this._keyStr.indexOf(a.charAt(k++)),g=this._keyStr.indexOf(a.charAt(k++)),h=this._keyStr.indexOf(a.charAt(k++)),i=this._keyStr.indexOf(a.charAt(k++)),b=f<<2|g>>4,c=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(b),64!==h&&(j+=String.fromCharCode(c)),64!==i&&(j+=String.fromCharCode(e));return j=d._utf8_decode(j)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=0,e=0,f=0;c<a.length;)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(e=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&e),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&e)<<6|63&f),c+=3);return b}},e=[],f=[],g=[],h=[];this.selected=e,this.expanded=f,this.allFilterItems=g,this.tags=h;var i=function(a,c){var d=!1;return b.forEach(a,function(a){a===c&&(d=!0)}),d},j=function(a,c){if(b.isObject(c)){c=b.copy(c),delete c._meta;var e=d.encode(JSON.stringify(c));b.forEach(a,function(b,c){b===e&&a.splice(c,1)})}},k=function(a,c){if(b.isObject(c)){c=b.copy(c),delete c._meta;var e=d.encode(JSON.stringify(c));i(a,e)||a.push(e)}},l=function(a,c){var e=!1;if(b.isObject(c)){c=b.copy(c),delete c._meta;var f=d.encode(JSON.stringify(c));b.forEach(a,function(a){a===f&&(e=!0)})}return e};this.create=function(b){return c=b,new a},this.getTableCtrl=function(){return c},this.addSelected=function(a){k(e,a)},this.addExpanded=function(a){k(f,a)},this.removeSelected=function(a){j(e,a)},this.removeExpanded=function(a){j(f,a)},this.isSelected=function(a){return l(e,a)},this.isExpanded=function(a){return l(f,a)},this.onDataLoaded=function(){c.onDataLoaded()},this.cleanup=function(){e=[],f=[]},this.getSelected=function(){var a=[];return b.forEach(e,function(b){var c=JSON.parse(d.decode(b));a.push(c)}),a},this.getSelectedCount=function(){return e.length},this.setTag=function(a){h.push(a)},this.getTags=function(){return h}};p.$inject=[],o.service("tableService",p);var o=b.module("TT-UI.Table.Directives",[]);d.$inject=["$compile","$timeout","$filter","tableService"],o.directive("ttTable",d),e.$inject=["$document"],o.directive("stDirection",e),f.$inject=["$timeout"],o.directive("ttTablePagination",f),g.$inject=[],o.directive("ttTableCheckbox",g),h.$inject=["$compile"],o.directive("ttTableTooltip",h),i.$inject=[],o.directive("ttTableTextTooltip",i),j.$inject=["$compile","$timeout","$parse","$filter"],o.directive("ttTableDropdown",j),k.$inject=["$document"],o.directive("ttTableFilterDropdownToggle",k),l.$inject=[],o.directive("ttTableFilterTags",l),m.$inject=[],o.directive("ttTableFocus",m),n.$inject=[],o.directive("ttTableEnter",n);var o=b.module("TT-UI.Table.Filters",[]);o.filter("unique",function(){return function(a,c){if(!1===c)return a;if((c||b.isUndefined(c))&&b.isArray(a)){var d=[],e=function(a){return b.isObject(a)&&b.isString(c)?a[c]:a};b.forEach(a,function(a){for(var c=!1,f=0;f<d.length;f++)if(b.equals(e(d[f]),e(a))){c=!0;break}c||d.push(a)}),a=d}return a}})}(window,window.angular);
//# sourceMappingURL=ttui-table.min.js.map