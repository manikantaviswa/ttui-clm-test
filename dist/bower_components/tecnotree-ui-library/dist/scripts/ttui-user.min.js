/*! TT-UI Lib 0.6.24.19 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ttui-user"),function(a,b,c){"use strict";function d(a,c,d,e,f,g,h){var i=f.get(d.AUTH_MODULE);e.clearData(),a.User=e,a.$watch("userAuthorized",function(a){if(!a)return void e.clearData();i.$fetch().then(e.populateData).catch(e.clearData)});var j;a.$on("$stateChangeStart",function(a,f,i){if(b.isString(f.permission)){if(j)return void(j=!1);a.preventDefault(),e.getPermissions().then(function(a){g.hasUserPermission(f.permission,a)?(j=!0,c.go(f,i)):(h.show("Error","It seems that you have tried to perform an operation which you are not permitted to perform. If you think this message is wrong, please contact admin","danger",!0),c.go(d.HOME_STATE))})}})}function e(a,b){function c(a,b){return d?d[a]||d[b]:null}var d,e,f=a.defer(),g=function(a){var c=b.getMoment();if(a){var d=c(a,"YYYYMMDDHHmmssZZ");return new Date(d).toUTCString()}return null};return{populateData:function(a){d=a;var b=d&&d.permissions?d.permissions.split(","):[];e=b,f.resolve(b)},clearData:function(){d=null,e=[]},getGivenName:c.bind({},"given_name","name"),getFamilyName:c.bind({},"family_name","name"),getFullName:function(){return d?d.given_name&&d.family_name?d.given_name+" "+d.family_name:d.name:null},getLastLoginTime:function(){if(!d)return null;if(d.login_time){var a=d.login_time.split(",");return g(a[1])}return null},getCurrentLoginTime:function(){if(!d)return null;if(d.login_time){var a=d.login_time.split(",");return g(a[0])}return null},getLoginName:function(){return d&&d.preferred_username?d.preferred_username:null},getPermissions:function(){return f.promise},getPermissionsV2:function(){var b=a.defer();return e?b.resolve(e):f.promise.then(function(){b.resolve(e)}),b.promise},getUserPhoto:function(){return d?d.picture:null},getUserLocation:function(){return d&&d.location?d.location:null},getSalesChannel:function(){return"CLM"},getOrganization:function(){return d&&d.organization?d.organization:null},get:function(){return d?{userName:this.getFullName(),loginName:this.getLoginName(),location:this.getUserLocation(),salesChannel:this.getSalesChannel(),lastLoginTime:this.getLastLoginTime(),currentLoginTime:this.getCurrentLoginTime(),organization:this.getOrganization()}:null}}}function f(){function a(a){return function(){return{$fetch:function(){return a.resolve(b)}}}}var b;this.setFakeUserInfo=function(a){b=a},a.$inject=["$q"],this.$get=a}function g(){function a(a){function d(b){var d=c[b];return d||(a.warn("Permission "+b+" isn't mapped"),d=b),d}function e(a){return b.isString(a)&&""!==a}function f(a){var b=a.split(".").join("\\.");return b=b.split("+").join("\\+"),b=b.split("?").join("\\?"),b=b.split("$").join("\\$"),"*"!==b.slice(-1)&&(b+="$"),new RegExp(b)}function g(a,c){var g=d(a);return b.isArray(c)&&c.filter(e).some(function(a){return"*"===a||("*"===g.slice(-1)&&a.length>g.length?f(g).test(a):f(a).test(g))})}return{hasUserPermission:g}}var c={};this.setMappings=function(a){c=a},a.$inject=["$log"],this.$get=a}var h=b.module("TT-UI.User",["ui.router","TT-UI.Config","TT-UI.Common.Services.FlashMessage","TT-UI.User.Services.CurrentUser","TT-UI.User.Services.UserInfoFactory","TT-UI.User.Services.Permissions"]);d.$inject=["$rootScope","$state","CONFIG","CurrentUser","UserInfoFactory","Permissions","FlashMessage"],h.run(d);var h=b.module("TT-UI.User.Services.CurrentUser",["TT-UI.Common.AngularStrap"]);e.$inject=["$q","moment"],h.factory("CurrentUser",e);var h=b.module("TT-UI.User.Services.FakeUserInfo",[]);h.provider("FakeUserInfo",f),b.module("TT-UI.User.Services.OAuthUserInfo",["ngResource","TT-UI.Config"]).factory("UserInfoConfig",["CONFIG",function(a){return{apiUrl:a.USER_SERVICE_API_URL,method:"GET"}}]).factory("OAuthUserInfo",["$resource","UserInfoConfig",function(a,b){return a(b.apiUrl,{},{fetch:{method:b.method}})}]);var h=b.module("TT-UI.User.Services.Permissions",[]);h.provider("PermissionsProvider".replace("Provider",""),g),b.module("TT-UI.User.Services.UserInfoFactory",["TT-UI.User.Services.OAuthUserInfo","TT-UI.User.Services.FakeUserInfo"]).factory("UserInfoFactory",["OAuthUserInfo","FakeUserInfo",function(a,b){return{get:function(c){switch(c){case"FakeAuth":return new b;case"OAuth":default:return new a}}}}])}(window,window.angular);
//# sourceMappingURL=ttui-user.min.js.map