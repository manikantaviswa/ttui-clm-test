/*! TT-UI Lib 0.6.24.19 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ttui-wizard-manager"),function(a,b,c){"use strict";function d(a,b,c){a.$on("$stateChangeStart",b.setCurrentFlowListener),a.$on("$stateChangeSuccess",b.redirectToFirstStep),a.$on(c.STEP_VALID_STATUS_EVENT,b.setCurrentStateValidity)}function e(){return{MAIN_STATE:"index",WIZARD_STATE:"flow-manager",STEP_VALID_STATUS_EVENT:"stepValidStatus",STEP_CHANGE_START:"flowStepChangeStart",STEP_CHANGE_END:"flowStepChangeEnd",STEP_COLLECT_DATA_EVENT:"stepCollectData",PREV_STEP_ACTION:"prevStepAction",NEXT_STEP_ACTION:"nextStepAction",SUBMIT_FLOW_ACTION:"submitFlowAction",PERSIST_FLOW_ACTION:"persistFlowAction",CANCEL_FLOW_ACTION:"cancelFlowAction",FINISH_FLOW_ACTION:"finishFlowAction",BASE_URL:"scripts/wizard-manager/"}}function f(a,c,d){var e=[];this.on=function(a,d){e.push(c.$on(a,function(){b.isFunction(this[d])&&this[d].apply(this,arguments)}.bind(this)))},a.$on("$destroy",function(){e.forEach(function(a){a()})}),this.on(d.STEP_COLLECT_DATA_EVENT,"onCollectData"),this.on(d.STEP_CHANGE_START,"onStepChangeStart"),this.on(d.STEP_CHANGE_END,"onStepChangeEnd"),this.formValidityStatusChange=function(a,b){c.$emit(d.STEP_VALID_STATUS_EVENT,a,b)},this.onCollectData=function(){},this.onStepChangeEnd=function(){},this.onStepChangeStart=function(){}}function g(){return f}function h(a,b,c){var d=c.BASE_URL+"views/";a.state(c.WIZARD_STATE,{parent:b.getMainState(),abstract:!0,views:{"@":{controller:"WizardCtrl as wizard",templateUrl:d+"wizard.tpl.html"}}})}function i(a,b,d,e,f,g,h){function i(){return f()}function j(a,b){return l(b).then(i).then(a).finally(m.bind(c,b))}function k(a){d.go(g.getExitState(),a)}function l(a){return n(h.STEP_CHANGE_START,a)}function m(a){return n(h.STEP_CHANGE_END,a)}function n(b,c){var d=g.getFlowName();return e.$emit(b,d,c).defaultPrevented?a.reject():a.resolve()}var o=g.getWizardSteps();e.$on(h.STEP_CHANGE_END,function(){o.length=0,o.push.apply(o,g.getWizardSteps())}),this.getWizardSteps=function(){return o},this.hasPrevStep=function(){return!!g.getPrevStepState()},this.hasNextStep=function(){return!!g.getNextStepState()},this.showSubmitButton=function(){return g.isSubmitStep()},this.showPersistButton=function(){return g.showPersistButton()},this.showCancelButton=function(){return g.showCancelButton()},this.goToPrevStep=function(){if(!this.hasPrevStep())return void b.error("Missing prev step");j(g.processPrevStep.bind(g),h.PREV_STEP_ACTION).then(function(){d.go(g.getPrevStepState())})},this.goToNextStep=function(){if(!this.hasNextStep())return void b.error("Missing next step");j(g.processNextStep.bind(g),h.NEXT_STEP_ACTION).then(function(){d.go(g.getNextStepState())})},this.submitFlow=function(){this.showSubmitButton()&&j(g.submit.bind(g),h.SUBMIT_FLOW_ACTION).then(function(a){var b=g.getNextStepState()||g.getExitState();d.go(b,a)})},this.persistFlow=function(){j(g.persist.bind(g),h.PERSIST_FLOW_ACTION).then(k)},this.cancelFlow=function(){j(g.cancel.bind(g),h.CANCEL_FLOW_ACTION).then(k)},this.finishFlow=function(){j(g.finish.bind(g),h.FINISH_FLOW_ACTION).then(k)},this.isFullscreenStep=function(){return g.isFullscreenStep()},this.showWizardSteps=function(){return g.showWizardSteps()},this.getActionLabel=function(a){return g.getActionLabel(a)},this.isFooterExtended=function(){return g.isFooterExtended()}}function j(){return{restrict:"A",require:"^form",link:function(a,b,c,d){a.$watch(function(){return d.$valid},function(){a.$eval(c.validityChange,{isValid:d.$valid,errors:d.$error})})}}}function k(a){var b=a.BASE_URL+"views/directives/";return{restrict:"E",replace:!0,transclude:!0,controller:["$scope","$state",function(a,b){a.steps=[];var c,d=a.steps;this.selectStep=function(a){d.forEach(function(a){a.selected=!1}),c=a.state.name,a.selected=!0,b.go(c)},this.addStep=function(a){d.push(a)}}],templateUrl:b+"wizard.tpl.html"}}function l(a,b,c,d){var e=a.BASE_URL+"views/directives/";return{restrict:"E",replace:!0,require:"^wizard",scope:!0,link:function(a,e,f,g){a.state=d.get(f.name),a.disabled=c(f.disabled)(),a.state||b.error('Missing state definition for state named "'+f.name+'"'),g.addStep(a),a.select=function(){g.selectStep(a)},a.isStepSelected=function(a){return d.includes(a)},a.isStateDisabled=function(){return a.disabled},f.$observe("disabled",function(b){a.disabled=c(b)()})},templateUrl:e+"wizard-step.tpl.html"}}function m(a,c,d,e){function f(a,d,e,f,g,h,j){function k(a){var d=a.service;if(b.isUndefined(d)||!f.has(d))throw new Error('Flow service "'+d+'" for given flow is missing');var e=f.get(d),g=new e(a.name,a.label,a.state,a.entryState,a.exitState,a.stepsStates);return c.value(g.getName(),g),g}function l(a){T.push(a.getName())}function m(a,b){b.parent&&b.parent===j.WIZARD_STATE&&(a.preventDefault(),d.go(J(),null,{reload:!0}))}function n(a,b){return o(b)}function o(b){S=null;var c=h.stateBelongsToFlow(b.name,j.WIZARD_STATE);c&&(T.length||a.error("There are none registered flows"),T.some(function(a){var b=f.get(a);return c===b.getFlowStateName()&&b.isValid()&&(S=b),S}),t()||a.error("Can not find valid flow"))}function p(){return S.getName()}function q(){return S.getWizardSteps()}function r(){return t()?S:null}function s(){return d.$current.name}function t(){return!!S}function u(){return S.getNextStepState(s())}function v(){return S.getPrevStepState(s())}function w(){return e.when(S.processNextStep(s(),R()))}function x(){return S.store(s(),R())}function y(){return S.isSubmitStep(s())}function z(){return S.showPersistButton(s())}function A(){return S.showCancelButton(s())}function B(){return S.isFullscreenStep(s())}function C(){return S.showWizardSteps(s())}function D(){return S.clearValidity(),e.when(S.start(s()))}function E(){return S.clearValidity(),e.when(S.cancel(s()))}function F(){return e.when(S.finish())}function G(){return w()}function H(a,b){return o(a),S.clearValidity(),e.when(S.resume(b))}function I(){return e.when(S.persist(s())).then(function(a){return S.clearValidity(),a})}function J(){return S.getEntryState()}function K(){return S.getExitState()}function L(a,b,c){return S.setCurrentStateValidity(s(),b,c)}function M(a){return S.getValidators(a||s())}function N(){return S.getPayload()}function O(){return S.getPopulatedStepsSchema()}function P(a){return S.getActionLabel(s(),a)}function Q(){return S.isFooterExtended(s())}function R(){var a={};return g.$emit(j.STEP_COLLECT_DATA_EVENT,a),a}var S,T=[];return i.getFlows().map(k,this).forEach(l,this),{setCurrentFlow:o,setCurrentFlowListener:n,getCurrentFlow:r,getFlowName:p,redirectToFirstStep:m,getWizardSteps:q,hasFlow:t,getNextStepState:u,getPrevStepState:v,isSubmitStep:y,showPersistButton:z,showCancelButton:A,isFullscreenStep:B,showWizardSteps:C,processNextStep:w,processPrevStep:x,getValidators:M,collectData:R,start:D,cancel:E,submit:G,resume:H,persist:I,finish:F,getPayload:N,getPopulatedStepsSchema:O,getEntryState:J,getExitState:K,setCurrentStateValidity:L,getActionLabel:P,isFooterExtended:Q}}var g,h=[],i=this,j=["name","service","state","url","entryState","exitState","stepsStates"];this.setMainState=function(a){g=a},this.getMainState=function(){return g||e.MAIN_STATE},this.registerFlow=function(c){var f;if(b.isString(c)&&(c=b.extend(arguments[1],{name:c})),f=c.name,j.forEach(function(a){if(!c.hasOwnProperty(a))throw new Error('Flow Manager: flow configuration "'+a+'" is missing for flow "'+f+'"')}),!b.isObject(c.stepsStates)||b.isArray(c.stepsStates))throw new Error('Flow Manager: Flow "'+f+'" steps configuration is not an object');var g=c.views||{};return d.setStateNameAtViews(e.WIZARD_STATE,g),a.state(c.state,{parent:e.WIZARD_STATE,url:c.url,label:c.label,views:g}),h.push(c),this},this.getFlows=function(){return h},this.$get=f,this.$get.$inject=["$log","$state","$q","$injector","$rootScope","StatesHelper","FLOW_MANAGER_CONFIG"]}function n(){function a(a,b){return b.match(d)?b.replace(d,"$1@"+a):b}function b(b,c){var d;Object.keys(c).forEach(function(e){d=c[e],delete c[e],c[a(b,e)]=d})}function c(a){function b(b,c){var d=b.match(e),f=d?d.pop():b,g=a.get(f);if(g&&g.parent&&g.parent===c)return g.name}return{stateBelongsToFlow:b}}var d=/^([^@]+)@flow$/,e=/([^\.]+)\.[^\.]+$/;this.setStateNameAtViews=b,c.$inject=["$state"],this.$get=c}function o(a,c,d,e){var f={};this.addStep=function(a){var d;if(b.isString(a)&&(a=b.extend(arguments[1],{name:a})),d=a.name,a.isStep=!0,b.isObject(a.views)&&c.setStateNameAtViews(e.WIZARD_STATE,a.views),f.hasOwnProperty(d))throw new Error('Wizard Manager: given step name is already registerd "'+d+'"');f[d]=a},this.$get=function(){function c(){function c(c,d){if(!f.hasOwnProperty(d))throw new Error('Wizard Manager: given step name is not registerd "'+d+'"');var e=f[d];a.state(c+"."+d,b.copy(e))}function e(c,d,e){var g=f[e].parent;if(b.isString(g)&&-1!==c.indexOf(g)){var h=b.copy(f[e]);h.parent=d+"."+g,a.state(d+"."+e,h)}}function g(a){var d=b.isString(a.state)?a.state:a.state.name,f=Object.keys(a.stepsStates);f.forEach(c.bind(null,d)),h.forEach(e.bind(null,f,d))}var h=Object.keys(f);d.getFlows().forEach(g)}return{registerFlowsSteps:c}}}function p(a){a.registerFlowsSteps()}function q(a,c,d,e,f,g,h){var i=function(a,b,c,d,e,f){this._name=a,this._label=b,this._stateName=c,this._validity={},g.call(this,d,e,f)};return i.prototype=Object.create(g.prototype),i.prototype.constructor=i,i.prototype._isStateAvailable=function(c){var d=this.getStates();if(!d.hasOwnProperty(c))return a.error("Missing state",c),!1;var e=d[c],f=!e.hasOwnProperty("enabled")||e.enabled;return b.isString(f)&&b.isFunction(this[f])?this[f].apply(this):f},i.prototype._findRelativeNextState=function(a,b){var c,d=Object.keys(this.getStates()),e=b?1:-1,f=function(b,d,f){var g=f[d+e];return a?g===a&&(c=b):c=b,c};return d.filter(this._isStateAvailable,this).some(f,this),c},i.prototype.getName=function(){return this._name},i.prototype.getLabel=function(){return this._label},i.prototype.getFlowStateName=function(){return this._stateName},i.prototype.hasState=function(a){var b=this._getStepStateNameFromFlowState(a);return this.getStates().hasOwnProperty(b)},i.prototype.getWizardSteps=function(){var a=this.getStates();return Object.keys(a).filter(function(b){return!!a[b].visible}).map(function(a){return{name:this._getFlowStepStateName(a),enabled:this._isStateAvailable(a)}}.bind(this))},i.prototype.setCurrentStateValidity=function(b,c,d){this.hasState(b)||a.error("Missing state",b),this._validity[b]={valid:c,error:d}},i.prototype.isCurrentStepValid=function(a){var b=!!this.hasState(a)&&this._validity[a];return b&&b.valid?c.when(!0):c.reject(b.error||!1)},i.prototype.validate=function(){function b(a){return h&&a.name===f&&(h=!1),h&&a.enabled}function d(b){var c=g[b.name]||!1,d=!!c&&c.valid;return d||a.error("Validation: Step is invalid",b.name,c),d}var e=this.getWizardSteps(),f=this.getSubmitState(),g=this._validity,h=!0;return e.filter(b).every(d)?c.when():c.reject("Flow is not valid")},i.prototype.clearValidity=function(){this._validity={}},i.prototype.getNextStepState=function(a){var b=this._getStepStateNameFromFlowState(a),c=g.prototype.getNextStepState.call(this,b);return c&&(c=this._getFlowStepStateName(c)),c},i.prototype.getPrevStepState=function(a){var b=this._getStepStateNameFromFlowState(a),c=g.prototype.getPrevStepState.call(this,b);if(c&&!this._isStepAfterSubmitStep(c))return this._getFlowStepStateName(c)},i.prototype._isStepAfterSubmitStep=function(a){var b=this.getSubmitState(),c=a;do{if(c===b)return!0}while(c=this._findRelativeNextState(c,!0));return!1},i.prototype.getEntryState=function(){var a=g.prototype.getEntryState.call(this);return this._getFlowStepStateName(a)},i.prototype.isSubmitStep=function(a){return this._getStepStateNameFromFlowState(a)===this.getSubmitState()},i.prototype.showPersistButton=function(a){var b=this._getStateConfig(a);return!b||!b.hasOwnProperty("persistButton")||b.persistButton},i.prototype.showCancelButton=function(a){var b=this._getStateConfig(a);return!b||!b.hasOwnProperty("cancelButton")||b.cancelButton},i.prototype.isFullscreenStep=function(a){var b=this._getStateConfig(a);return!(!b||!b.hasOwnProperty("fullscreen"))&&b.fullscreen},i.prototype.showWizardSteps=function(a){var b=this._getStateConfig(a);return!b||!b.hasOwnProperty("wizardSteps")||b.wizardSteps},i.prototype.getValidators=function(a){function e(a,c){return b.isArray(a[c])?a[c]:[]}var f=this._getStateConfig(a);if(b.isUndefined(f))return c.reject("Missing state :"+a);if(b.isUndefined(f.validators))return c.when([]);var g=e(f.validators,"common"),h=e(f.validators,this.getStrategy());return g=g.concat(h),c.all(g.map(function(a){return d.get(a).then(function(a){return a.data})}))},i.prototype.getStrategy=function(){return h.NO_STRATEGY},i.prototype._getStateConfig=function(a){var b=this._getStepStateNameFromFlowState(a);return this.getStates()[b]},i.prototype._getStepStateNameFromFlowState=function(a){var b=e.get(a),c=b&&b.parent||a,d=this.getFlowStateName();return c.replace(new RegExp("^"+d+"\\."),"")},i.prototype._getFlowStepStateName=function(a){return[this.getFlowStateName(),a].join(".")},i.prototype.getPayload=function(){throw new Error("getPayload method must be implemented")},i.prototype.getPopulatedStepsSchema=function(){throw new Error("getPopulatedStepsSchema method must be implemented")},i.prototype.start=function(){throw new Error("start method must be implemented")},i.prototype.processNextStep=function(a,d){var e=this._getStateActions(a),f=c.when(d);return b.isArray(e)&&e.length?e.reduce(function(b,c){return b.then(function(){return this[c].call(this,a,d)}.bind(this))}.bind(this),f):f},i.prototype.getActionLabel=function(a,b){var c=this._getStateConfig(a),d=f("customLabels."+b)(c);return d||b},i.prototype.isFooterExtended=function(){return!1},i.prototype._getStateActions=function(c){var d=this._getStateConfig(c);return b.isArray(d.nextActions)?d.nextActions.filter(function(c){return!!b.isFunction(this[c])||(a.error("action "+c+" does not exist in the flow"),!1)}.bind(this)):[]},i}var r=b.module("TT-UI.WizardManager.ChangeFlow",["TT-UI.WizardManager.Config","TT-UI.WizardManager.Services.FlowManager"]);d.$inject=["$rootScope","FlowManager","FLOW_MANAGER_CONFIG"],r.run(d);var r=b.module("TT-UI.WizardManager.Config",[]);r.constant("FLOW_MANAGER_CONFIG",e());var r=b.module("TT-UI.WizardManager.Controllers.StepCtrl",["TT-UI.WizardManager.Config"]);r.factory("stepCtrlFn",g);var r=b.module("TT-UI.WizardManager.Controllers.Wizard",["TT-UI.WizardManager.Config","TT-UI.WizardManager.Services.FlowManager","TT-UI.WizardManager.Directives.Wizard"]);h.$inject=["$stateProvider","FlowManagerProvider","FLOW_MANAGER_CONFIG"],r.config(h),i.$inject=["$q","$log","$state","$rootScope","$timeout","FlowManager","FLOW_MANAGER_CONFIG"],r.controller("WizardCtrl",i);var r=b.module("TT-UI.WizardManager.Directives.ValidityChange",[]);r.directive("validityChange",j);var r=b.module("TT-UI.WizardManager.Directives.Wizard",["ui.router","pascalprecht.translate","TT-UI.WizardManager.Config"]);k.$inject=["FLOW_MANAGER_CONFIG"],r.directive("wizard",k),l.$injector=["FLOW_MANAGER_CONFIG","$log","$parse","$state"],r.directive("wizardStep",l),b.module("TT-UI.WizardManager",["TT-UI.WizardManager.Config","TT-UI.WizardManager.ChangeFlow","TT-UI.WizardManager.Controllers.StepCtrl","TT-UI.WizardManager.Controllers.Wizard","TT-UI.WizardManager.Services.FlowManager","TT-UI.WizardManager.Services.WizardFlow","TT-UI.WizardManager.Services.StepsManager","TT-UI.WizardManager.Services.StatesHelper","TT-UI.WizardManager.Directives.ValidityChange","TT-UI.WizardManager.Directives.Wizard"]);var r=b.module("TT-UI.WizardManager.Services.FlowManager",["ui.router","TT-UI.WizardManager.Config","TT-UI.WizardManager.Services.StatesHelper"]);m.$inject=["$stateProvider","$provide","StatesHelperProvider","FLOW_MANAGER_CONFIG"],r.provider("FlowManager",m);var r=b.module("TT-UI.WizardManager.Services.StatesHelper",["ui.router"]);r.provider("StatesHelper",n);var r=b.module("TT-UI.WizardManager.Services.StepsManager",["ui.router","TT-UI.WizardManager.Config","TT-UI.WizardManager.Services.FlowManager","TT-UI.WizardManager.Services.StatesHelper"]);o.$inject=["$stateProvider","StatesHelperProvider","FlowManagerProvider","FLOW_MANAGER_CONFIG"],r.provider("StepsManager",o),p.$inject=["StepsManager"],r.run(p);var r=b.module("TT-UI.WizardManager.Services.WizardFlow",["ui.router","TT-UI.Common.Services.Flow"]);r.constant("WIZARD_FLOW_SETTINGS",{NO_STRATEGY:""}),q.$inject=["$log","$q","$http","$state","$parse","FlowFactory","WIZARD_FLOW_SETTINGS"],r.factory("WizardFlow",q)}(window,window.angular);
//# sourceMappingURL=ttui-wizard-manager.min.js.map